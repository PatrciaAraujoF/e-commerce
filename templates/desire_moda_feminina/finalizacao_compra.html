{% extends 'desire_moda_feminina/base.html' %}
{% block content %}
<div class="container">
    <style>
        .titulo-container {
            display: flex;
            justify-content: center; /* Centraliza horizontalmente */
            align-items: center; /* Centraliza verticalmente se necessário */
        }

        h1.titulo_destaques {
            text-align: center; /* Textualmente centraliza dentro de um elemento flex */
            margin: 0;
        }

        label {
            font-weight: bolder;
        }
    </style>
  
    <div class="titulo-container p-5">
        <h1 class="titulo_destaques">Finalizar Compra</h1>
    </div>
    
    <!-- Lista de Itens do Carrinho -->
    <h2 class="fw-bolder">Revisão do Carrinho</h2>
    <ul>
        {% for item in itens_detalhes %}
            <li>{{ item.nome }} - Quantidade: {{ item.quantidade }} - Preço Unitário: {{ item.preco }} BRL</li>
        {% endfor %}
    </ul>
    <p>Total: {{ total }} BRL</p>

    <!-- Formulário de Pagamento -->
    <form id="payment-form" method="POST">
        {% csrf_token %}
        
        <!-- Campos de Informações do Cliente -->
        <div class="form-group">
            <label for="customer-name">Nome</label>
            <input type="text" class="form-control" id="customer-name" name="customer_name" value="{{ usuario }}" readonly>
        </div>
        
        <div class="form-group">
            <label for="customer-address">Endereço</label>
            <input type="text" class="form-control" id="customer-address" name="customer_address" placeholder="Digite seu endereço" required>
        </div>

        <!-- Elemento do Cartão do Stripe -->
        <div class="form-group">
            <label for="card-element">Dados do Cartão</label>
            <div id="card-element" class="form-control">
                <!-- Um elemento de cartão será inserido aqui pelo Stripe Elements. -->
            </div>
        </div>
        <div id="card-errors" role="alert"></div>
<br>
        <button type="submit" class="btn contact-button" id="submit-button">Pagar com Stripe</button>
    </form>
<br>
    <!-- Inclua o Stripe.js -->
    <script src="https://js.stripe.com/v3/"></script>
    
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const stripe = Stripe('{{ stripe_public_key }}');
            const elements = stripe.elements();
            const card = elements.create('card', { style: { base: { fontSize: '16px' }}});
            card.mount('#card-element');

            card.on('change', function(event) {
                const displayError = document.getElementById('card-errors');
                if (event.error) {
                    displayError.textContent = event.error.message;
                } else {
                    displayError.textContent = '';
                }
            });

            const form = document.getElementById('payment-form');
            form.addEventListener('submit', function(event) {
                event.preventDefault();

                stripe.createToken(card).then(function(result) {
                    if (result.error) {
                        const errorElement = document.getElementById('card-errors');
                        errorElement.textContent = result.error.message;
                    } else {
                        const hiddenInput = document.createElement('input');
                        hiddenInput.setAttribute('type', 'hidden');
                        hiddenInput.setAttribute('name', 'stripeToken');
                        hiddenInput.setAttribute('value', result.token.id);
                        form.appendChild(hiddenInput);

                        // Submete o formulário
                        form.submit();
                    }
                });
            });
        });
    </script>
</div>
{% endblock %}